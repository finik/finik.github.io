<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Dmitry Fink</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Dmitry Fink">
<meta property="og:url" content="http://finik.net/">
<meta property="og:site_name" content="Dmitry Fink">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dmitry Fink">
<meta name="twitter:description">
<meta name="twitter:creator" content="@finik">
<link rel="publisher" href="102647827171370750000">

  
    <link rel="alternative" href="/atom.xml" title="Dmitry Fink" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17764337-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Dmitry Fink</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/resume">Resume</a>
        
          <a class="main-nav-link" href="/contact">Contact</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://finik.net"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Managing-iOS-build-configurations" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/30/Managing-iOS-build-configurations/" class="article-date">
  <time datetime="2016-08-30T22:53:26.000Z" itemprop="datePublished">Aug 30 2016</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/30/Managing-iOS-build-configurations/">Managing iOS build configurations</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Why?">Why?</h2>
<p>Applications today are rarely being built without 3rd party libraries and SDKs. There are libraries for integrating remote backends into your app. Libraries for effective image caching and loading. Libraries for gathering analytics and libraries for pushing messages. Libraries that help your users report issues, help you debug and analyze crashes. (Yes, that last one is Bugsee)</p>
<p>It is also a common practice for developers to maintain more than flavor of the application during active development. A debug version of the application may require a new version of the backend server which also might be under development still, it might send analytics data to a different service or it may need to include a helper library that is not necessary in the release version.</p>
<p>This following tutorial describes several options for maintaining different build configurations.</p>
<p>We are using Bugsee SDK as an example in this tutorial. At the same time, we do want to point out, that Bugsee SDK is extremely lightweight and doesn’t impact your user’s experience. Bugsee also passes all Apple Appstore requirements. A lot of Bugsee’s customers have seen the benefits of shipping the library in their App Store builds, it provides them with video-enabled crash reporting and in-app bug reporting.</p>
<h2 id="Debug_vs-_Release">Debug vs. Release</h2>
<p>This one is the default most common setup you get when you create your application with xCode. With preprocessor macros it is easy to differentiate at compile time between a Debug and a Release build. Thus, it is easy to launch (or not launch) a library in any particular configuration. Lets launch Bugsee only in Debug build.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#if DEBUG</span></div><div class="line"><span class="preprocessor">#import "Bugsee/Bugsee.h"</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">....</div><div class="line"></div><div class="line">- (BOOL)application:(UIApplication *)application</div><div class="line">    didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {</div><div class="line">    <span class="comment">// ...other initialization code</span></div><div class="line"><span class="preprocessor">#if DEBUG </span></div><div class="line">    [Bugsee launchWithToken:@<span class="string">"your app token"</span>];</div><div class="line"><span class="preprocessor">#endif</span></div></pre></td></tr></table></figure>

<p>So now you don’t import and don’t run it, but the framework is still getting packaged into your application. If you use CocoaPods for you library management, there is a solution, starting with v0.34, CocoaPods honors build configurations. All you have to do is put the following in your Podfile:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod <span class="string">'Bugsee'</span>, <span class="symbol">:configurations</span> =&gt; [<span class="string">'Debug'</span>]</div></pre></td></tr></table></figure>

<p>Unfortunately, if you manually copy libraries into your project, you are out of luck.</p>
<h2 id="Debug_vs-_Release_(+TestFlight)">Debug vs. Release (+TestFlight)</h2>
<p>In this configuration you still manage and maintain two build flavors (Debug and Release). The Release build is first distributed to QA and Beta testers through Apple TestFlight and only when ready you promote it to App Store. The beauty of this approach is that it is the same build(same binary!). Thus, you can be sure there are no differences between what was tested and what was released. This means, however, that Bugsee SDK must be part of that Release build and you just want to disable it when it is being installed from App Store.</p>
<p>Fortunately, it is easy to differentiate between App Store and Testflight installations in run-time and initialize Bugsee only when appropriate:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application</div><div class="line">    didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions {</div><div class="line">    <span class="comment">// ...other initialization code</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> ([[[[<span class="built_in">NSBundle</span> mainBundle] appStoreReceiptURL] lastPathComponent] isEqualToString:<span class="string">@"sandboxReceipt"</span>]) {</div><div class="line">        <span class="comment">// We are in TestFlight, enable Bugsee!</span></div><div class="line">        [Bugsee launchWithToken:<span class="string">@"your app token"</span>];</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Debug_vs-_Release_vs-_Beta">Debug vs. Release vs. Beta</h3>
<p>In this setup you create and maintain three build flavors. Distribution method of the Beta flavor is not important, it can be done either through Ad-hoc distribution (see our <a href="">tutorial on building in house Ad-hoc distribution using S3</a>) or through TestFlight. In this setup you are back to detecting the configuration at compile. Adding an additional configuration, however, is a multi step process:</p>
<p>Go to your project <strong>Info</strong>, and under <strong>Configurations</strong>, create a new one by duplicating the Release one.</p>
<p><img src="/images/build-config/create-configuration.png" alt=""></p>
<p>Go to Build Settings and in Preprocessor Macros and add BETA=1 to that new Beta configuration (note that this is actually the place DEBUG=1 is being set for that Debug build).</p>
<p><img src="/images/build-config/add-macro.png" alt=""></p>
<p>Voila! You can now detect Release versus Beta build at compilation time. Other than the BETA flag, the builds are identical.</p>
<p>Let’s launch Bugsee in Debug and Beta only:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#if ( DEBUG || BETA)</span></div><div class="line"><span class="preprocessor">#import "Bugsee/Bugsee.h"</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">....</div><div class="line"></div><div class="line">- (BOOL)application:(UIApplication *)application</div><div class="line">    didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {</div><div class="line">    <span class="comment">// ...other initialization code</span></div><div class="line"><span class="preprocessor">#if (DEBUG || BETA)</span></div><div class="line">    [Bugsee launchWithToken:@<span class="string">"your app token"</span>];</div><div class="line"><span class="preprocessor">#endif</span></div></pre></td></tr></table></figure>

<p>Let’s use that CocoaPods trick to install the library only in Debug and Beta builds:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod <span class="string">'Bugsee'</span>, <span class="symbol">:configurations</span> =&gt; [<span class="string">'Debug'</span>, <span class="string">'Beta'</span>]</div></pre></td></tr></table></figure>

<p>The only thing left to do is to build the Beta configuration.</p>
<p>First of all, go to <strong>Product-&gt;Schemes-&gt;Edit</strong> Scheme and click on Duplicate Scheme button. Name it properly (if your original scheme was called MyApp, call the new one MyApp Beta).</p>
<p><img src="/images/build-config/duplicate-scheme.png" alt=""></p>
<p>Edit the new scheme, and change the configuration of the Archive step to use Beta configuration.</p>
<p><img src="/images/build-config/scheme-configuration.png" alt=""></p>
<p>That’s it. Now you have two schemes, one for Appstore and one for Beta releases. As long as you are developing and using <strong>Build &amp; Run</strong>, they are identical, and it doesn’t matter which one you are using. It matters though when you do <strong>Archive</strong>, depending whether you want to produce and IPA for App Store or Ad-Hoc, remember to switch to the right one.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://finik.net/2016/08/30/Managing-iOS-build-configurations/" data-id="x77o2fo3zq4j9eqc" class="article-share-link">Share</a>
      
        <a href="http://finik.net/2016/08/30/Managing-iOS-build-configurations/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ios-build-tesflight/">ios, build, tesflight</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-iOS-Ad-hoc-distribution-using-Amazon-S3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/28/iOS-Ad-hoc-distribution-using-Amazon-S3/" class="article-date">
  <time datetime="2016-08-29T04:50:35.000Z" itemprop="datePublished">Aug 28 2016</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/28/iOS-Ad-hoc-distribution-using-Amazon-S3/">iOS Ad-hoc distribution using Amazon S3</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Why?">Why?</h2>
<p>Every iOS developer at some point in their life is challenged with a task to distribute their awesome app to a group of loyal beta testers. Apple does not make it easy. The reasons for this are clear. We all care about security and greatly appreciate the fact that iOS platform is much more secure than its main competitor, but it is still a problem that needs to be solved.  There are services out there that try to automate the ad-hoc distribution process, but sometimes it is not desirable or even possible to use them. Thus, there is a need to bake an in-house distribution system.</p>
<p>To make the ad-hoc distribution work, one must:</p>
<ul>
<li>Upload the IPA file to a place where it can be downloaded</li>
<li>Generate a special plist xml file, referring to the IPA above. This file must be accessible over https!</li>
<li>Generate an html file with a special <strong>Download</strong> link, pointing to the plist file above. This is the page users will see</li>
</ul>
<p>Throughout this tutorial, we are going to use an application called Dishero as an example. We will host it directly on S3, without spinning up machines or configuring http servers. The result will look similar to this:</p>
<p><img src="/images/s3-ad-hoc/iphone.png" alt=""></p>
<p>We will produce a nice webpage, hosted on S3 that will provide details and a one-click install for our application.</p>
<h2 id="Prerequisites">Prerequisites</h2>
<h3 id="Create_an_Ad-hoc_distribution_profile">Create an Ad-hoc distribution profile</h3>
<p>First of all you will need to create a distribution profiles in iTunes Connect.</p>
<p>Ad-Hoc distribution limits the the ability to install your application only on specific devices that have to be pre-registered. Instruct your beta users to visit <a href="http://whatsmyudid.com/" target="_blank" rel="external">http://whatsmyudid.com/</a> and to follow the instructions there to obtain UDID (Unique Device ID) for their device and send it to you.</p>
<p>Follow the pictures below to create an Ad-Hoc provisioning profile, and add all the devices to it. Download it once ready and install in your local keychain by double-clicking on it.</p>
<p><img src="/images/s3-ad-hoc/step1.png" alt=""><br><img src="/images/s3-ad-hoc/step2.png" alt=""><br><img src="/images/s3-ad-hoc/step3.png" alt=""><br><img src="/images/s3-ad-hoc/step4.png" alt=""><br><img src="/images/s3-ad-hoc/step5.png" alt=""></p>
<h3 id="Create_a_bucket_on_S3_and_enable_web_hosting_on_it">Create a bucket on S3 and enable web hosting on it</h3>
<p>You will also need a dedicated bucket on S3 for this. Make sure you enable Web Hosting on your bucket as shown in the picture below.<br><strong>Bonus</strong>: If you want to have your download page to be at a nice URL (we are using download.dishero.com for this example), you have to do a few tricks:</p>
<ol>
<li>Name your bucket accordingly - <strong>download.dishero.com</strong></li>
<li>In your DNS, configure a CNAME record <strong>download.dishero.com</strong> to point to <strong>download.dishero.com</strong>.s3.amazonaws.com.</li>
</ol>
<h3 id="Install_S3cmd">Install S3cmd</h3>
<p>We will need <a href="http://s3tools.org/" target="_blank" rel="external">s3cmd</a> to upload the files to S3 and set the right permissions.</p>
<p>Installing it using <a href="http://brew.sh/" target="_blank" rel="external">homebrew</a> is easy:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew <span class="operator"><span class="keyword">install</span> s3cmd</span></div></pre></td></tr></table></figure>

<p>So is installing it using python’s pip:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">sudo</span> pip install s3cmd</div></pre></td></tr></table></figure>

<p>…or you can just follow the manual process described on s3cmd website.</p>
<p>Once you have it installed, run it</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">s3cmd</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">configure</span></div></pre></td></tr></table></figure>

<p>and enter your AWS credentials when prompted. Credentials will be saved and we won’t need to state them explicitly anymore.</p>
<h2 id="Where_the_magic_happens">Where the magic happens</h2>
<p>The script below does all the heavy lifting. It generates index.html, proper plist file and uploads them along with the IPA itself to S3.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line"><span class="xml">#!/bin/bash</span></div><div class="line">set -e</div><div class="line"></div><div class="line">PROJECT="Dishero"</div><div class="line">FILE=$1</div><div class="line">TARGET=$2</div><div class="line">VERSION=$3</div><div class="line">BUILD=$4</div><div class="line">BUILD_TIME=`stat -f "%Sm" -t "%Y-%m-%d %H:%M:%S" $1`</div><div class="line">SECURE_TARGET="https://s3-us-west-2.amazonaws.com/${TARGET}"</div><div class="line"></div><div class="line">echo "Generating ${PROJECT}-${VERSION}-${BUILD}.plist"</div><div class="line">cat &gt; ./${PROJECT}-${VERSION}-${BUILD}.plist <span class="tag">&lt;&lt;<span class="attribute">PLIST_DELIM</span></span></div><div class="line">&lt;?<span class="attribute">xml</span> <span class="attribute">version</span>=<span class="value">"1.0"</span> <span class="attribute">encoding</span>=<span class="value">"UTF-8"</span><span class="value">?</span>&gt;</div><div class="line"><span class="doctype">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">plist</span> <span class="attribute">version</span>=<span class="value">"1.0"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">dict</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="title">key</span>&gt;</span>items<span class="tag">&lt;/<span class="title">key</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="title">array</span>&gt;</span></div><div class="line"> </div><div class="line">  <span class="tag">&lt;<span class="title">dict</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="title">key</span>&gt;</span>assets<span class="tag">&lt;/<span class="title">key</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="title">array</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">dict</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="title">key</span>&gt;</span>kind<span class="tag">&lt;/<span class="title">key</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="title">string</span>&gt;</span>software-package<span class="tag">&lt;/<span class="title">string</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="title">key</span>&gt;</span>url<span class="tag">&lt;/<span class="title">key</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="title">string</span>&gt;</span>http://${TARGET}/${PROJECT}-${VERSION}-${BUILD}.ipa<span class="tag">&lt;/<span class="title">string</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="title">dict</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="title">array</span>&gt;</span></div><div class="line">  </div><div class="line">   <span class="tag">&lt;<span class="title">key</span>&gt;</span>metadata<span class="tag">&lt;/<span class="title">key</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="title">dict</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">key</span>&gt;</span>bundle-identifier<span class="tag">&lt;/<span class="title">key</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">string</span>&gt;</span>${BUNDLE}<span class="tag">&lt;/<span class="title">string</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">key</span>&gt;</span>bundle-version<span class="tag">&lt;/<span class="title">key</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">string</span>&gt;</span>${VERSION}<span class="tag">&lt;/<span class="title">string</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">key</span>&gt;</span>kind<span class="tag">&lt;/<span class="title">key</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">string</span>&gt;</span>software<span class="tag">&lt;/<span class="title">string</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">key</span>&gt;</span>subtitle<span class="tag">&lt;/<span class="title">key</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">string</span>&gt;</span>${PROJECT}<span class="tag">&lt;/<span class="title">string</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">key</span>&gt;</span>title<span class="tag">&lt;/<span class="title">key</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">string</span>&gt;</span>${PROJECT}<span class="tag">&lt;/<span class="title">string</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="title">dict</span>&gt;</span></div><div class="line"> </div><div class="line">  <span class="tag">&lt;/<span class="title">dict</span>&gt;</span></div><div class="line"> <span class="tag">&lt;/<span class="title">array</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">dict</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">plist</span>&gt;</span></div><div class="line"></div><div class="line">PLIST_DELIM</div><div class="line"></div><div class="line">echo "Generating index.html"</div><div class="line">cat &gt; ./index.html <span class="tag">&lt;&lt;<span class="attribute">INDEX_DELIM</span></span></div><div class="line">&lt;!<span class="attribute">DOCTYPE</span> <span class="attribute">html</span> <span class="attribute">PUBLIC</span> "<span class="attribute">-</span>//<span class="attribute">W3C</span>//<span class="attribute">DTD</span> <span class="attribute">XHTML</span> <span class="attribute">1.0</span> <span class="attribute">Transitional</span>//<span class="attribute">EN</span>" "<span class="attribute">http:</span>//<span class="attribute">www.w3.org</span>/<span class="attribute">TR</span>/<span class="attribute">xhtml1</span>/<span class="attribute">DTD</span>/<span class="attribute">xhtml1-transitional.dtd</span>"&gt;</div><div class="line"><span class="tag">&lt;<span class="title">html</span> <span class="attribute">xmlns</span>=<span class="value">"http://www.w3.org/1999/xhtml"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"Content-Type"</span> <span class="attribute">content</span>=<span class="value">"text/html; charset=UTF-8"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">title</span>&gt;</span>${PROJECT} ${VERSION} (${BUILD})<span class="tag">&lt;/<span class="title">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">style</span> <span class="attribute">type</span>=<span class="value">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line"><span class="tag">body</span> <span class="rules">{<span class="rule"><span class="attribute">background</span>:<span class="value"><span class="hexcolor">#fff</span></span></span>;<span class="rule"><span class="attribute">margin</span>:<span class="value"><span class="number">0</span></span></span>;<span class="rule"><span class="attribute">padding</span>:<span class="value"><span class="number">0</span></span></span>;<span class="rule"><span class="attribute">font-family</span>:<span class="value">arial,helvetica,sans-serif</span></span>;<span class="rule"><span class="attribute">text-align</span>:<span class="value">center</span></span>;<span class="rule"><span class="attribute">padding</span>:<span class="value"><span class="number">10px</span></span></span>;<span class="rule"><span class="attribute">color</span>:<span class="value"><span class="hexcolor">#333</span></span></span>;<span class="rule"><span class="attribute">font-size</span>:<span class="value"><span class="number">16px</span></span></span>;<span class="rule">}</span></span></div><div class="line"><span class="id">#container</span> <span class="rules">{<span class="rule"><span class="attribute">width</span>:<span class="value"><span class="number">300px</span></span></span>;<span class="rule"><span class="attribute">margin</span>:<span class="value"><span class="number">0</span> auto</span></span>;<span class="rule">}</span></span></div><div class="line"><span class="tag">h1</span> <span class="rules">{<span class="rule"><span class="attribute">margin</span>:<span class="value"><span class="number">0</span></span></span>;<span class="rule"><span class="attribute">padding</span>:<span class="value"><span class="number">0</span></span></span>;<span class="rule"><span class="attribute">font-size</span>:<span class="value"><span class="number">14px</span></span></span>;<span class="rule">}</span></span></div><div class="line"><span class="tag">p</span> <span class="rules">{<span class="rule"><span class="attribute">font-size</span>:<span class="value"><span class="number">13px</span></span></span>;<span class="rule">}</span></span></div><div class="line"><span class="class">.link</span> <span class="rules">{<span class="rule"><span class="attribute">background</span>:<span class="value"><span class="hexcolor">#ecf5ff</span></span></span>;<span class="rule"><span class="attribute">border-top</span>:<span class="value"><span class="number">1px</span> solid <span class="hexcolor">#fff</span></span></span>;<span class="rule"><span class="attribute">border</span>:<span class="value"><span class="number">1px</span> solid <span class="hexcolor">#dfebf8</span></span></span>;<span class="rule"><span class="attribute">margin-top</span>:<span class="value">.<span class="number">5em</span></span></span>;<span class="rule"><span class="attribute">padding</span>:<span class="value">.<span class="number">3em</span></span></span>;<span class="rule">}</span></span></div><div class="line"><span class="class">.link</span> <span class="tag">a</span> <span class="rules">{<span class="rule"><span class="attribute">text-decoration</span>:<span class="value">none</span></span>;<span class="rule"><span class="attribute">font-size</span>:<span class="value"><span class="number">15px</span></span></span>;<span class="rule"><span class="attribute">display</span>:<span class="value">block</span></span>;<span class="rule"><span class="attribute">color</span>:<span class="value"><span class="hexcolor">#069</span></span></span>;<span class="rule">}</span></span></div><div class="line"><span class="class">.warning</span> <span class="rules">{<span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">12px</span></span></span>; <span class="rule"><span class="attribute">color</span>:<span class="value"><span class="hexcolor">#F00</span></span></span>; <span class="rule"><span class="attribute">font-weight</span>:<span class="value">bold</span></span>; <span class="rule"><span class="attribute">margin</span>:<span class="value"><span class="number">10px</span> <span class="number">0px</span></span></span>;<span class="rule">}</span></span></div><div class="line"><span class="tag">&lt;/<span class="title">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"container"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">h1</span>&gt;</span>iOS 7.0 and newer:<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">p</span>&gt;</span>${PROJECT} Beta ${VERSION} (${BUILD})<span class="tag">&lt;/<span class="title">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">p</span>&gt;</span>Built on ${BUILD_TIME}<span class="tag">&lt;/<span class="title">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"link"</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"itms-services://?action=download-manifest;url=${SECURE_TARGET}/${PROJECT}-${VERSION}-${BUILD}.plist"</span>&gt;</span>Tap to install!<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">p</span>&gt;</span><span class="tag">&lt;<span class="title">strong</span>&gt;</span>Link didn't work?<span class="tag">&lt;/<span class="title">strong</span>&gt;</span><span class="tag">&lt;<span class="title">br</span> /&gt;</span>Make sure you're visiting this page on your device, not your computer.<span class="tag">&lt;/<span class="title">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></div><div class="line">INDEX_DELIM</div><div class="line"></div><div class="line">echo "Uploading ${PROJECT}-${VERSION}-${BUILD}.ipa to s3://${TARGET}"</div><div class="line">s3cmd put -P $FILE s3://${TARGET}/${PROJECT}-${VERSION}-${BUILD}.ipa</div><div class="line">echo "Uploading ${PROJECT}-${VERSION}-${BUILD}.plist to s3://${TARGET}"</div><div class="line">s3cmd put -P ${PROJECT}-${VERSION}-${BUILD}.plist s3://${TARGET}/${PROJECT}-${VERSION}-${BUILD}.plist</div><div class="line">echo "Uploading index.html to s3://${TARGET}"</div><div class="line">s3cmd put -P index.html s3://${TARGET}/</div></pre></td></tr></table></figure>

<p>Executing the script requires only a few parameters: an IPA file, a bucket path, a version and a build</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor"># $PATH_TO_SCRIPT/upload_to_s3.sh <span class="title">&lt;IPA_FILE&gt;</span> <span class="title">&lt;TARGET_PATH&gt;</span> <span class="title">&lt;VERSION&gt;</span> <span class="title">&lt;BUILD&gt;</span></span></div><div class="line">$PATH_TO_SCRIPT/upload_to_s3<span class="variable">.sh</span> Dishero<span class="variable">.ipa</span> download<span class="variable">.dishero</span><span class="variable">.com</span>/beta <span class="number">2.5</span><span class="number">.0</span> <span class="number">1795</span></div></pre></td></tr></table></figure>

<p>The command above will make the download page available at <a href="http://download.dishero.com/beta" target="_blank" rel="external">http://download.dishero.com/beta</a>. Alternatively, if DNS is not under your control and you can’t do CNAME tricks to get a proper hostname, you will have to point your users to <a href="https://s3-us-west-2.amazonaws.com/bucketname/path/" target="_blank" rel="external">https://s3-us-west-2.amazonaws.com/bucketname/path/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://finik.net/2016/08/28/iOS-Ad-hoc-distribution-using-Amazon-S3/" data-id="t77lkj8lw7vcpgpt" class="article-share-link">Share</a>
      
        <a href="http://finik.net/2016/08/28/iOS-Ad-hoc-distribution-using-Amazon-S3/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aws-build-ios/">aws, build, ios</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bidi" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/30/bidi/" class="article-date">
  <time datetime="2014-10-31T05:17:42.000Z" itemprop="datePublished">Oct 30 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/30/bidi/">Typing bidi text</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I feel stupid asking it, but where can I learn that sacral secret knowledge of typing hebrew text mixed with english, numbers and punctuation using modern editors and operating systems? Oh, and after typing, being able to copy-paste it to another app/window while preserving the right order of elements in a sentence. I can’t remember the last time I did that, I think the most popular text editor in Israel was called Einstein back then and copy-paste hasn’t been discovered by humanity yet, in any case I can’t seem to be able to do it now, no matter what I try. All I need is to type two short sentences.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://finik.net/2014/10/30/bidi/" data-id="jq1fvfcoasi9edk0" class="article-share-link">Share</a>
      
        <a href="http://finik.net/2014/10/30/bidi/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bidi/">bidi</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hebrew/">hebrew</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rant/">rant</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Beanstalk" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/29/Beanstalk/" class="article-date">
  <time datetime="2014-10-30T05:33:15.000Z" itemprop="datePublished">Oct 29 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/29/Beanstalk/">NGINX rewrites on Amazon Elastic Beanstalk</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>We are running most of our backend code at <a href="https://www.dishero.com" target="_blank" rel="external">Dishero</a> on Amazon Elastic Beanstalk and it has been great so far. With Elastic Beanstalk we don’t need to worry about provisoning new instances and auto-scaling, in most cases it just allows us to upload our app and ELB takes care of the rest, however in some rare cases when we actually want to tinker with the internals and do some changes to the actual container it appears to be non-trivial and sometimes takes time to figure out.</p>
<h2 id="Typical_ELB_setup">Typical ELB setup</h2>
<p>In a typical auto-scaled ELB setup, we have one elastic load balancer and multiple instances that execute our code. The setup is as follows:</p>
<ul>
<li>Elastic Load Balancer is the one that is terminating the SSL connection, traffic to our instances is pure HTTP over port 80. You can find out more about setting up SSL certificates on Elastic Beanstalk <a href="http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/configuring-https.html" target="_blank" rel="external">here</a>.</li>
<li>The instances are configured to forward all traffic from port 80 to 8080 using iptables.</li>
<li>Each instance has an NGINX running, which is listening on port 80880 and forwarding the traffic to our actual Node applicaiton.</li>
</ul>
<h2 id="The_problem">The problem</h2>
<p>We want to configure nginx to redirect all non-https traffic to https, and while we are at it to redirect all non-www traffic to www (i.e always push users to <a href="https://www.example.com/" target="_blank" rel="external">https://www.example.com/</a>…).</p>
<ul>
<li>It would be nice also to serve these as one redirect, taking a naive approach and writing two different rules (one for www and one for https) might result in two sequential redirects.</li>
<li>Since we are running the same configuration on multiple configurations which have different base URLs, we do not want to hardcode the actual URLs in the actual rulesm but rather keep them generic.</li>
</ul>
<h2 id="The_solution">The solution</h2>
<p>After several unsuccessfull iterations we arrived at the following set of rules:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="title">set</span> <span class="variable">$fixedWWW</span> <span class="string">''</span>;</div><div class="line"><span class="title">set</span> <span class="variable">$needRedir</span> <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="comment"># nginx does not allow nested if statements</span></div><div class="line"></div><div class="line"><span class="comment"># check and decide on adding www prefix</span></div><div class="line"><span class="title">if</span> (<span class="variable">$host</span> !<span class="regexp">~* ^www(.*))</span> {</div><div class="line">	<span class="title">set</span> <span class="variable">$fixedWWW</span> <span class="string">'www.'</span>;</div><div class="line">	<span class="title">set</span> <span class="variable">$needRedir</span> <span class="number">1</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment"># what about that https? the traffic is all http right now</span></div><div class="line"><span class="comment"># but elastic load balancer tells us about the original scheme</span></div><div class="line"><span class="comment"># using $http_x_forwarded_proto variable</span></div><div class="line"><span class="title">if</span> (<span class="variable">$http_x_forwarded_proto</span> != <span class="string">'https'</span>) {</div><div class="line">	<span class="title">set</span> <span class="variable">$needRedir</span> <span class="number">1</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment"># ok, so whats the verdict, do we need to redirect?</span></div><div class="line"><span class="title">if</span> (<span class="variable">$needRedir</span> = <span class="number">1</span>) {</div><div class="line">	<span class="title">rewrite</span><span class="regexp"> ^(.*)</span> <span class="url">https://$fixedWWW$host$1</span> <span class="built_in">redirect</span>;</div><div class="line">}</div></pre></td></tr></table></figure>



<p>So the question is where should we put it?</p>
<p>The file that configures nginx to proxy traffic from 8080 to the application in the Elastic Beanstalk environment is located at <strong>/etc/nginx/conf.d/00_elastic_beanstalk_proxy.conf</strong></p>
<p>Obviously, SSH’ing to all the instances, modifying the file and restarting nginx manually is of no use, it will get overwritten next time the app is deployed and newly deployed instances won’t have the changes either.<br>Luckily for us Beanstalk allows us to customize the EC2 environment it provisions using <a href="http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/customize-containers-ec2.html" target="_blank" rel="external">configuration files</a>, that system is pretty flexible and allows not only to install yum packages, write and overwrite files in the system, but to run commands and shell scripts during app deployments as well.</p>
<p>We may be tempted to use the config files to overwrite the <strong>00_elastic_beanstalk_proxy.conf</strong> file in <strong>/etc/nginx/conf.d</strong> directly, and then wonder where are our changes and why they are nowhere to be seen in the system. Actually it might work well if all we want is add new nginx configuration files, but the issue is with existing nginx files, during the deployment process, the customization stage happens <strong>before</strong> nginx default files are being installed into their by the Elastic Beanstalk system, so even if we set up our copy of <strong>00_elastic_beanstalk_proxy.conf</strong>, moments later it will still be overwritten with the default one. We need to overwrite that default one instead, and the source location of these is <strong>/tmp/deployment/config/</strong>, the one we are mostly interested in is suprisingly named  <strong>#etc#nginx#conf.d#00_elastic_beanstalk_proxy.conf</strong> </p>
<p>So eventually, after all the trial and error, the solution appears to be quite simple, the one thing that needs to be added to our project is the following nginx.config file inside our .ebextensions folder:</p>
<figure class="highlight yaml"><figcaption><span>.ebextensions/nginx.config</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">files:</div><div class="line">  <span class="string">"/tmp/deployment/config/#etc#nginx#conf.d#00_elastic_beanstalk_proxy.conf"</span> :</div><div class="line">    mode: <span class="string">"000755"</span></div><div class="line">    owner: root</div><div class="line">    group: root</div><div class="line">    content: |</div><div class="line">        upstream nodejs {</div><div class="line">        	server <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8081</span>;</div><div class="line">        	keepalive <span class="number">256</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        server {</div><div class="line">            listen <span class="number">8080</span>;</div><div class="line"></div><div class="line">            <span class="keyword">set</span> <span class="variable">$fixedWWW</span> <span class="string">''</span>;</div><div class="line">            <span class="keyword">set</span> <span class="variable">$needRedir</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">            <span class="comment"># nginx does not allow nested if statements</span></div><div class="line"></div><div class="line">            <span class="comment"># check and decide on adding www prefix</span></div><div class="line">            <span class="keyword">if</span> (<span class="variable">$host</span> !~* ^www(.*)) {</div><div class="line">	         	  <span class="keyword">set</span> <span class="variable">$fixedWWW</span> <span class="string">'www.'</span>;</div><div class="line">	            <span class="keyword">set</span> <span class="variable">$needRedir</span> <span class="number">1</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="comment"># what about that https? the traffic is all http right now</span></div><div class="line">            <span class="comment"># but elastic load balancer tells us about the original scheme</span></div><div class="line">            <span class="comment"># using $http_x_forwarded_proto variable</span></div><div class="line">            <span class="keyword">if</span> (<span class="variable">$http_x_forwarded_proto</span> != <span class="string">'https'</span>) {</div><div class="line">	             <span class="keyword">set</span> <span class="variable">$needRedir</span> <span class="number">1</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="comment"># ok, so whats the verdict, do we need to redirect?</span></div><div class="line">            <span class="keyword">if</span> (<span class="variable">$needRedir</span> = <span class="number">1</span>) {</div><div class="line">                rewrite ^(.*) https://<span class="variable">$fixedWWW</span><span class="variable">$host</span><span class="variable">$1</span> redirect;</div><div class="line">            }</div><div class="line"></div><div class="line">            location / {</div><div class="line">                proxy_pass  http://nodejs;</div><div class="line">                proxy_<span class="keyword">set</span>_header   Connection <span class="string">""</span>;</div><div class="line">                proxy_http_version <span class="number">1.1</span>;</div><div class="line">                proxy_<span class="keyword">set</span>_header        Host            <span class="variable">$host</span>;</div><div class="line">                proxy_<span class="keyword">set</span>_header        X-Real-IP       <span class="variable">$remote_addr</span>;</div><div class="line">                proxy_<span class="keyword">set</span>_header        X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</div><div class="line">            }</div><div class="line">            gzip on;</div><div class="line">        }</div></pre></td></tr></table></figure>





      
    </div>
    <footer class="article-footer">
      <a data-url="http://finik.net/2014/10/29/Beanstalk/" data-id="x7vcva4824xn2aqp" class="article-share-link">Share</a>
      
        <a href="http://finik.net/2014/10/29/Beanstalk/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/amazon/">amazon</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aws/">aws</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elastic-beanstalk/">elastic beanstalk</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hexo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/29/hexo/" class="article-date">
  <time datetime="2014-10-29T08:13:23.000Z" itemprop="datePublished">Oct 29 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/29/hexo/">hexo</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Spent the evening setting up a new blog engine as I couldn’t revive the old one. This whole Ruby/Gem/Bundle mess is beyond me, it just never works. So this blog is now running on hexo. I am sure that won’t make me write more, but its Node.JS/NPM based, so at least I will be able to set it up again on a new machine if I suddenly do decide to.</p>
<p>What was it I wanted to blog about? I really can’t remember.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://finik.net/2014/10/29/hexo/" data-id="2kcubeajdzxhayr8" class="article-share-link">Share</a>
      
        <a href="http://finik.net/2014/10/29/hexo/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blog/">blog</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hexo/">hexo</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-google-reader" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/03/24/google-reader/" class="article-date">
  <time datetime="2013-03-25T00:41:00.000Z" itemprop="datePublished">Mar 24 2013</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/03/24/google-reader/">Google Reader</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Since Google has shut down the Reader I keep reading in various sources the same idea over and over again. The idea that RSS is an old technology, that it was and is used only by geeks, and that it is obsolete and not needed anymore as one is supposed to get his fix of news through social media (facebook, twitter) and social reading apps like zite, flipboard, etc.</p>
<p>What bothers me most is I read these same ideas in blogs of pretty technical people whose opinions I do usually value.</p>
<p>The interesting part is, if it wasn’t for the RSS, I wouldn’t be reading these blogs in the first place, as it would be too much of a hassle for me to visit each one of their individual sites to check whether they generated some new content. I am also not going to subscribe to their facebook or twitter feeds for the occasional notifications, as it has too much noise for my taste, I don’t care for their random 140 letter ideas, nor do I care about photos of their dinner, I only want their well structured thoughts, the ones they actually spent some time on. So if RSS dies tomorrow, chances are I will still visit some of these sites, but the frequency will become significantly lower with time, and eventually I might even forget about some of them, or give up on regularly reading blogs altogether.</p>
<p>I do agree that social media and tablet/iphone magazines do solve the problem of getting news, latest internet memes etc. I do use Flipboard, Facebook and Twitter myself. But these are things that will eventually pop up in one of these social feeds one way or another anyway, if I miss the post from site A then I will notice a repost from site B the next day or a week later. And even if I do miss some, who cares, knowing it doesn’t really bother me.</p>
<p>But what about personal blogs? I know John Doe, I know he is writing about a topic that is close to my heart, I want to read absolutely everything he writes and I want to read it the day he writes it because I like to be part of the discussion as well. I also like to read everything in one place and I want to be able to save reading some of these articles for later. Is there any technology besides RSS today that fits all these requirements?</p>
<p>I will happily admit RSS is dead if you can point me in the direction of that alternative technology. I don’t think you can though.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://finik.net/2013/03/24/google-reader/" data-id="uw8f0x7wqpqpwojo" class="article-share-link">Share</a>
      
        <a href="http://finik.net/2013/03/24/google-reader/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blog/">blog</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/google/">google</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rss/">rss</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hello-octopress" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/12/19/hello-octopress/" class="article-date">
  <time datetime="2012-12-20T06:08:00.000Z" itemprop="datePublished">Dec 19 2012</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2012/12/19/hello-octopress/">Hello, Octopress!</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I finally gave in to peer pressure and switched my blog to Octopress.</p>
<p>Apparently WordPress is not cool anymore and all the kids forgot php, uninstalled mysql, went back to generating static pages and just outsource all comment management headache to <a href="http://disqus.com" target="_blank" rel="external">Disqus</a>.</p>
<p>In the process if migration I decided I didn’t really have any important posts or comments I had to move over from the old blog (which was mostly a mirror of my old LiveJournal account anyway), so I just left all of them behind and starting from a clean sheet here.</p>
<p>Well, I actually did move <a href="/blog/2010/10/24/multiple-working-folders-with-single-git-repository">one</a> post, the only technical post I had there, and since the plan for this new blog to be fairly technical, I decided it will be a good start.</p>
<p>Wish me luck and lets hope I will actually write.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://finik.net/2012/12/19/hello-octopress/" data-id="6ix06l5d86t8rm1g" class="article-share-link">Share</a>
      
        <a href="http://finik.net/2012/12/19/hello-octopress/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blog/">blog</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/octopress/">octopress</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-multiple-working-folders-with-single-git-repository" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2010/10/24/multiple-working-folders-with-single-git-repository/" class="article-date">
  <time datetime="2010-10-24T20:52:00.000Z" itemprop="datePublished">Oct 24 2010</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/10/24/multiple-working-folders-with-single-git-repository/">Multiple working folders with single GIT repository</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="The_problem">The problem</h2>
<p>As much as I love GIT, there are several design decisions that make my everyday work really difficult. One of such design flaws is making the repository and the working folder tightly coupled. It is a serious problem for every developer who is frequently switching between several product/topic branches of the same project.</p>
<p>Git gives you two options to deal with this:</p>
<ul>
<li>Create different local clones of the repository and checkout different branch in every one of them.</li>
<li>Do all your work in one local repository, every time you have a task switch ether stash or commit your changes on the current branch and checkout a different one.</li>
</ul>
<p>As I quickly learned both solutions were not very practical for what I was doing. As a linux kernel developer in a company that actually ships multiple linux based products, I eventually found myself working and supporting several product branches, sometimes based on different versions of the kernel. One branch could be plain vanilla kernel.org kernel based on 2.6.32, another one could be an old product running of 2.6.24 with tons of additional architecture specific code that came from a vendor, etc. Both approaches had very serious drawbacks:</p>
<ul>
<li>Cloning a kernel repository for each product/branch would take more disk space (every copy of kernel repository is about 500MB), even though disk space is cheap today, you have to admit it doesn’t make sense to keep several copies of the same binary blob on your disk (UPDATE 10/25/2010: That is actually not true, cloning locally from the existing repository is done via hard links, so no extra space is wasted). But the biggest problem is synchronizing all these local repositories. If I need to merge branches or cherry-pick individual commits between them I end up pushing and pulling the changes through a shared remote repository, or connecting these local repositories as remotes to one another.</li>
<li>Doing all your work in one repository is not an option either, if you ever tried to checkout a 2.6.24 linux kernel branch while already having 2.6.35 in your folder you’d understand why, it takes time. When you are multi-tasking you usually try to minimize the overhead of each switch and having to stash your current work or create dummy commits every time you switch doesn’t seem like the right way to do it. Another drawback to this approach is there is no convenient way to do a nice visual diff between files and folders on two branches, yes, it’s doable, but it is not as easy as running “meld folderA folderB”.</li>
</ul>
<h2 id="The_solution">The solution</h2>
<p>I’m not going to take credit for the method I am going to show you, I wasn’t the one who came up with it, Ed, one of the guys on my team did. Ed actually developed whole set of useful scripts for kernel development involving frequent switching between product branching, but the part about branching and multiple working folders is applicable to other projects as well, so that’s what I want to share with you.<br>Actually the trick is quite trivial, we use our knowledge of git internals and unix symbolic links to achieve what we want. All we wanted is to have one repository and multiple working folders associated with it, so lets do just that. That is how our final folder structure will look like:</p>
<pre><code>project
+-.repo
  +-.git
    +-branches
    +-config
    +-description
    +-HEAD
    +-hooks
    +-objects
    +-info
    +-packed-refs
    +-refs
+-branchA
  +-.git
    +-branches<span class="function"> -&gt;</span> ..<span class="regexp">/../</span>.repo/.git/branches
    +-config<span class="function"> -&gt;</span> ..<span class="regexp">/../</span>.repo/config
    +-description
    +-HEAD
    +-index
    +-hooks<span class="function"> -&gt;</span> ..<span class="regexp">/../</span>.repo/hooks
    +-objects<span class="function"> -&gt;</span> ..<span class="regexp">/../</span>.repo/objects
    +-info<span class="function"> -&gt;</span> ..<span class="regexp">/../</span>.repo/info
    +-packed-refs<span class="function"> -&gt;</span> ..<span class="regexp">/../</span>.repo/packed-refs
    +-refs<span class="function"> -&gt;</span> ..<span class="regexp">/../</span>.repo/refs
+-branchB
+-branchC
...
etc
</code></pre><p>We created one wrapper “project” folder, one master GIT repository in .repo and a bunch of branchX folders. Each one of these folders is a legal GIT folder by itself, however it doesn’t keep its own config and objects/refs repositories, it links to the one in .repo instead. It does keep a private local version of HEAD, index (staging area) and the whole working folder. Every manipulation on the database performed in any of the branch folders is immediately visible in others (commits, branches, tags, remote changes), context switching is just a matter of changing folders now.</p>
<p>This is how we initialize this structure for the first time time:</p>
<figure class="highlight bash"><figcaption><span>init.sh</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">mkdir .repo</div><div class="line"><span class="built_in">pushd</span> .repo</div><div class="line"></div><div class="line">git init</div><div class="line">git remote add origin git://some.remote.url.../project.git</div><div class="line">git fetch origin</div><div class="line"></div><div class="line"><span class="built_in">popd</span></div><div class="line"></div><div class="line">newfolder.sh branchA</div><div class="line"><span class="built_in">pushd</span> branchA</div><div class="line">git checkout -b branchA origin/branchA</div><div class="line"><span class="built_in">popd</span></div><div class="line"></div><div class="line">newfolder.sh branchB</div><div class="line"><span class="built_in">pushd</span> branchB</div><div class="line">git checkout -b branchB origin/branchB</div><div class="line"><span class="built_in">popd</span></div></pre></td></tr></table></figure>

<p>The script we used to automate creation of a new working folder (newfolder.sh). We can call it as many times as we want an whenever we need to create a new folder.</p>
<figure class="highlight bash"><figcaption><span>newfolder.sh</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$1</span>"</span> == <span class="string">""</span> ]; <span class="keyword">then</span></div><div class="line">	<span class="built_in">echo</span> <span class="string">"Need to specify target."</span></div><div class="line">	<span class="keyword">return</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line">TARGET=<span class="variable">$1</span></div><div class="line">mkdir <span class="variable">$TARGET</span></div><div class="line"><span class="built_in">pushd</span> <span class="variable">$TARGET</span></div><div class="line"></div><div class="line">git init</div><div class="line"></div><div class="line"><span class="built_in">pushd</span> .git</div><div class="line"></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> branches config hooks info objects refs packed-refs ; <span class="keyword">do</span></div><div class="line">	rm -rf <span class="variable">$i</span></div><div class="line">	ln -sf ../../.repo/.git/<span class="variable">$i</span> <span class="variable">$i</span></div><div class="line"><span class="keyword">done</span></div><div class="line"></div><div class="line"><span class="built_in">popd</span> <span class="comment"># .git</span></div><div class="line"><span class="built_in">popd</span> <span class="comment"># $TARGET</span></div></pre></td></tr></table></figure>

<p>Enjoy! I find this method very useful already, but I’ll be glad to hear some feedback since I am sure someone will come up with a way to polish it and make it even better.</p>
<p><strong>Update 10/25/01</strong>: I wrote the post yesterday, and today I accidentally found out that the trick described above for a while has been a part of a standard git distribution and can be found in contrib/workdir/git-new-workdir :)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://finik.net/2010/10/24/multiple-working-folders-with-single-git-repository/" data-id="utsqqu16121m51v6" class="article-share-link">Share</a>
      
        <a href="http://finik.net/2010/10/24/multiple-working-folders-with-single-git-repository/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/build/">build</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/">git</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kernel/">kernel</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
</section>
        
          <aside id="sidebar">
  
      <div class="widget-wrap">
    <h3 class="widget-title">About</h3>
    <div class="widget">
      <img src="/images/portrait.jpg"><br>
      CTO and Founder of <a href="https://www.bugsee.com">Bugsee</a>. In previous life hacked and managed teams at Amazon, TI, Palm/HP, Zoran, Intel, Dishero<hr>
      <a href="https://linkedin.com/in/finik">https://linkedin.com/in/finik</a><br>
      <a href="https://angel.co/finik">https://angel.co/finik</a><br>
      <a href="https://twitter.com/finik">https://twitter.com/finik</a><br>
      <a href="https://github.com/finik">https://github.com/finik</a><br>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/08/30/Managing-iOS-build-configurations/">Managing iOS build configurations</a>
          </li>
        
          <li>
            <a href="/2016/08/28/iOS-Ad-hoc-distribution-using-Amazon-S3/">iOS Ad-hoc distribution using Amazon S3</a>
          </li>
        
          <li>
            <a href="/2014/10/30/bidi/">Typing bidi text</a>
          </li>
        
          <li>
            <a href="/2014/10/29/Beanstalk/">NGINX rewrites on Amazon Elastic Beanstalk</a>
          </li>
        
          <li>
            <a href="/2014/10/29/hexo/">hexo</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/amazon/">amazon</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aws/">aws</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aws-build-ios/">aws, build, ios</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bidi/">bidi</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/build/">build</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elastic-beanstalk/">elastic beanstalk</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google/">google</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hebrew/">hebrew</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ios-build-tesflight/">ios, build, tesflight</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kernel/">kernel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/octopress/">octopress</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rant/">rant</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rss/">rss</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/amazon/" style="font-size: 10.00px;">amazon</a><a href="/tags/aws/" style="font-size: 10.00px;">aws</a><a href="/tags/aws-build-ios/" style="font-size: 10.00px;">aws, build, ios</a><a href="/tags/bidi/" style="font-size: 10.00px;">bidi</a><a href="/tags/blog/" style="font-size: 20.00px;">blog</a><a href="/tags/build/" style="font-size: 10.00px;">build</a><a href="/tags/elastic-beanstalk/" style="font-size: 10.00px;">elastic beanstalk</a><a href="/tags/git/" style="font-size: 10.00px;">git</a><a href="/tags/google/" style="font-size: 10.00px;">google</a><a href="/tags/hebrew/" style="font-size: 10.00px;">hebrew</a><a href="/tags/hexo/" style="font-size: 10.00px;">hexo</a><a href="/tags/ios-build-tesflight/" style="font-size: 10.00px;">ios, build, tesflight</a><a href="/tags/kernel/" style="font-size: 10.00px;">kernel</a><a href="/tags/nginx/" style="font-size: 10.00px;">nginx</a><a href="/tags/octopress/" style="font-size: 10.00px;">octopress</a><a href="/tags/rant/" style="font-size: 10.00px;">rant</a><a href="/tags/rss/" style="font-size: 10.00px;">rss</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/10/">October 2010</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- test -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-5367834286297597"
     data-ad-slot="1326752408"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Dmitry Fink<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/resume" class="mobile-nav-link">Resume</a>
  
    <a href="/contact" class="mobile-nav-link">Contact</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'finiknet';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>